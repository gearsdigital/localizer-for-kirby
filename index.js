(function(){"use strict";const d="SAVE",c="CHANGE",_="REVERT",h="LANGUAGES_UPDATE",u="TRANSLATIONS_UPDATE",p="TRANSLATION_GROUP_ADD",f="TRANSLATION_GROUP_REMOVE",v="TRANSLATION_ADD",m="TRANSLATION_EDIT",k="TRANSLATION_REMOVE",y={actions:{[h]({commit:a},t){a("updateLanguages",t)},[u]({commit:a},t){a("udpateTranslations",t)},[p]({commit:a},t){a("addTranslationGroup",t)},[f]({commit:a},t){a("removeTranslationGroup",t)},[v]({commit:a},t){a("addTranslation",t)},[k]({commit:a},t){a("removeTranslation",t)},[m]({commit:a},t){a("editTranslation",t)},[d]({state:a}){localStorage.setItem("$localizer$",JSON.stringify(a.translations))},[c]({commit:a,state:t}){var i;const e=(i=localStorage.getItem("$localizer$"))!=null?i:"",n=JSON.stringify(t.translations);a("dirty",e!==n)},[_]({state:a}){const t=JSON.parse(localStorage.getItem("$localizer$"));t&&(a.translations=t)}},getters:{languages(a){const t=a.translations.map(({language:e})=>e.id);return a.languages.map(e=>({...e,disabled:t.includes(e.id)}))},getTranslationsForLanguage:a=>t=>a.translations.filter(({language:e})=>e.id===t).map(({translations:e})=>e.map(n=>n.key)).flat()},state:()=>({languages:[],translations:[],dirty:!1}),mutations:{updateLanguages(a,t){a.languages=t},udpateTranslations(a,t){a.translations=t},addTranslationGroup(a,t){a.translations.push({language:t,translations:[]})},removeTranslationGroup(a,t){a.translations=a.translations.filter(e=>e.language.id!==t)},addTranslation(a,t){const e=a.translations.findIndex(({language:n})=>n.id===t.id);e!==-1&&a.translations[e].translations.push(t.item)},removeTranslation(a,t){const e=a.translations.findIndex(({language:n})=>n.id===t.id);e!==-1&&(a.translations[e].translations=[...a.translations[e].translations.filter(n=>n.key!==t.key)])},editTranslation(a,t){const e=a.translations.findIndex(({language:n})=>n.id===t.id);e!==-1&&(a.translations[e].translations=[...a.translations[e].translations.map(n=>n.key===t.key?{...n,override:t.override}:n)])},dirty(a,t){a.dirty=t}}},at="";function l(a,t,e,n,i,g,T,B){var s=typeof a=="function"?a.options:a;t&&(s.render=t,s.staticRenderFns=e,s._compiled=!0),n&&(s.functional=!0),g&&(s._scopeId="data-v-"+g);var r;if(T?(r=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),i&&i.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(T)},s._ssrRegister=r):i&&(r=B?function(){i.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:i),r)if(s.functional){s._injectStyles=r;var W=s.render;s.render=function(Y,L){return r.call(L),W(Y,L)}}else{var $=s.beforeCreate;s.beforeCreate=$?[].concat($,r):[r]}return{exports:a,options:s}}const D={name:"LocalizerLanguageDialog",props:{openDialog:{type:Function,default:null}},data(){return{language:{}}},computed:{languages(){return this.$store.getters.languages}},methods:{selectLanguage(a){this.language=a},addTranslationGroup(){this.$store.dispatch(p,this.language),this.$refs.dialog.close(),this.language={}},cancel(){this.$refs.dialog.close()}}};var b=function(){var t=this,e=t._self._c;return e("k-button-group",[e("k-button",{attrs:{icon:"add"},on:{click:function(n){return t.$refs.dialog.open()}}},[t._v("Add Language")]),e("k-dialog",{ref:"dialog"},[e("header",[e("k-headline",[t._v("Select language")]),e("k-text",{attrs:{size:"small",theme:"help"}},[t._v(" Please pick one of all available languages you want to customize... ")])],1),e("div",{staticClass:"k-panel-localizer-translations"},t._l(t.languages,function(n){return e("k-item",{key:n.id,class:{disabled:n.disabled},attrs:{text:n.name,info:n.id},on:{click:function(i){return t.selectLanguage(n)}}})}),1),e("template",{slot:"footer"},[e("k-button-group",[e("k-button",{attrs:{icon:"cancel"},on:{click:t.cancel}},[t._v("Cancel")]),e("k-button",{attrs:{icon:"check"},on:{click:t.addTranslationGroup}},[t._v("Add")])],1)],1)],2)],1)},z=[],A=l(D,b,z,!1,null,"a1c32932",null,null);const C=A.exports,nt="",R={name:"LocalizerTranslationListEntry",props:{entry:{type:Object,default:null}}};var E=function(){var t=this,e=t._self._c;return t.entry.translations.length>0?e("table",[t._m(0),t._l(t.entry.translations,function(n,i){return e("tr",{key:n.key},[e("td",[e("code",[t._v(t._s(n.key))])]),e("td",[t._v(t._s(n.text))]),n.override?e("td",[e("b",[t._v(t._s(n.override))])]):t._e(),n.override?t._e():e("td",[t._v("\u2013")]),e("td",[e("k-dropdown",[e("k-button",{attrs:{icon:"dots"},on:{click:function(g){return t.$refs.dropdown[i].toggle()}}}),e("k-dropdown-content",{ref:"dropdown",refInFor:!0,attrs:{align:"right",options:[{icon:"edit",text:"Edit",click:()=>t.$emit("edit",{id:t.entry.language.id,key:n.key,text:n.text,override:n.override})},{icon:"trash",text:"Delete",click:()=>t.$emit("remove",{id:t.entry.language.id,key:n.key})}]}})],1)],1)])})],2):e("k-empty",{attrs:{layout:"cards"},on:{click:function(n){return t.$emit("add",t.entry.language.id)}}},[t._v(" Add your first translation. ")])},S=[function(){var a=this,t=a._self._c;return t("tr",[t("th",[a._v("Key")]),t("th",[a._v("Text")]),t("th",[a._v("Override")]),t("th")])}],x=l(R,E,S,!1,null,null,null,null);const N=x.exports,it="",O={name:"LocalizerTranslations",props:{code:{type:String,default:""}},data(){return{translations:[],pagination:{limit:10,total:0,page:1},q:null}},computed:{pagedTranslationDataList(){return Object.keys(this.translations).length===0?[]:Object.entries(this.translations).map(a=>({key:a[0],text:a[1],disabled:this.selectedTranslations.includes(a[0])}))},selectedTranslations(){return this.$store.getters.getTranslationsForLanguage(this.code)},isLoading(){return this.$store.state.isLoading}},watch:{q:function(a,t){a!==t&&this.fetchTranslations()}},created(){this.fetchTranslations=this.$helper.debounce(this.fetchTranslations,250)},mounted(){this.fetchTranslations()},methods:{async fetchTranslations(a=1){const{data:t,pagination:e}=await this.$api.get(`localizer/translations/${this.code}`,{page:a,q:this.q});this.translations=t!=null?t:[],this.pagination=e},updatePagination(a){this.fetchTranslations(a.page),this.pagination=a}}};var I=function(){var t=this,e=t._self._c;return e("div",[e("k-input",{staticClass:"k-dialog-search",attrs:{icon:t.isLoading?"loader":"search",placeholder:t.$t("search")+" \u2026",autofocus:"true",type:"text"},model:{value:t.q,callback:function(n){t.q=n},expression:"q"}}),t.pagedTranslationDataList.length>0?e("div",{staticClass:"k-panel-localizer-translations"},t._l(t.pagedTranslationDataList,function(n){return e("k-item",{key:n.key,class:{disabled:n.disabled},attrs:{text:n.text,info:n.key,layout:"cards"},on:{click:function(i){return t.$emit("select",n)}}})}),1):e("k-empty",[t._v("Nothing found")]),e("k-pagination",{ref:"pagination",attrs:{align:"center",details:!0,limit:t.pagination.limit,total:t.pagination.total},on:{paginate:t.updatePagination}})],1)},w=[],G=l(O,I,w,!1,null,"ff838f80",null,null);const P=G.exports,st="",F={name:"LocalizerTranslationList",components:{LocalizerTranslationListEntry:N,LocalizerTranslations:P},data(){return{code:null,selected:{},dialogContent:{language:{},translations:[]},editDialogContent:{},translationCollection:[]}},computed:{translationList(){return this.$store.state.localizer.translations}},methods:{removeTranslationGroup(){this.$store.dispatch(f,this.dialogContent.language.id),this.$refs.deleteDialog.close()},openDeleteDialog(a){this.dialogContent=a,this.$refs.deleteDialog.open()},openTranslationDialog(a){this.code=a,this.$refs.addDialog.open()},openTranslationEditDialog(a){this.editDialogContent={...a,override:a.override||a.text},this.$refs.editDialog.open()},select(a){this.selected=a},addSelectedTranslation(){this.$store.dispatch(v,{id:this.code,item:this.selected}),this.$refs.addDialog.close()},removeFromGroup(a){this.$store.dispatch(k,a)},saveEditedTranslation(){this.$store.dispatch(m,this.editDialogContent),this.$refs.editDialog.close(),this.editDialogContent={}}}};var U=function(){var t=this,e=t._self._c;return e("div",[t.translationList.length?e("div",t._l(t.translationList,function(n){return e("section",{key:n.language.id,staticClass:"k-localizer-section"},[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v(" "+t._s(n.language.name)+" "),e("abbr",[t._v(t._s(n.language.id))])]),e("k-button-group",{attrs:{buttons:[{text:t.$t("add"),icon:"add",click:()=>t.openTranslationDialog(n.language.id)},{text:t.$t("delete"),icon:"trash",click:()=>t.openDeleteDialog(n)}]}})],1),e("LocalizerTranslationListEntry",{attrs:{entry:n},on:{add:function(i){return t.openTranslationDialog(i)},remove:t.removeFromGroup,edit:t.openTranslationEditDialog}})],1)}),0):e("k-empty",[t._v("Start by adding a language which you want to adapt.")]),e("k-dialog",{ref:"deleteDialog",attrs:{"submit-button":"Delete",theme:"negative",icon:"trash"},on:{submit:t.removeTranslationGroup}},[e("header",[e("k-headline",[t._v("Delete \xBB"+t._s(t.dialogContent.language.name)+"\xAB")]),e("k-text",{attrs:{size:"small",theme:"help"}},[t._v(" Do you really want to delete all custom translations for this language? ")])],1)]),e("k-dialog",{ref:"addDialog",attrs:{"submit-button":"Add",theme:"positive",icon:"add",size:"medium"},on:{submit:t.addSelectedTranslation}},[e("header",[e("k-headline",[t._v("Add translation")]),e("k-text",{attrs:{size:"small",theme:"help"}},[t._v(" Select the translation you want to override.")])],1),e("LocalizerTranslations",{attrs:{code:t.code},on:{select:t.select}})],1),e("k-dialog",{ref:"editDialog",attrs:{"submit-button":"Save",theme:"positive",icon:"add",size:"medium"},on:{submit:t.saveEditedTranslation}},[e("header",{staticClass:"edit-dialog-header"},[e("k-headline",[e("code",[t._v(t._s(t.editDialogContent.key))]),e("abbr",[t._v(t._s(t.editDialogContent.id))])]),e("k-text",{attrs:{size:"small",theme:"help"}},[t._v("Define your custom translation override.")])],1),e("k-form",{attrs:{fields:{override:{label:!1,counter:!1,buttons:!1,help:t.editDialogContent.text,type:"textarea"}}},model:{value:t.editDialogContent,callback:function(n){t.editDialogContent=n},expression:"editDialogContent"}})],1)],1)},V=[],q=l(F,U,V,!1,null,null,null,null);const M=q.exports,ot="",H={name:"PanelLocalizer",components:{LocalizerTranslationList:M,LocalizerLanguageDialog:C},data(){return{initiallyLoaded:!1}},computed:{isLoading(){return this.$store.state.isLoading},translations(){return this.$store.state.localizer.translations},isDirty(){return this.$store.state.localizer.dirty}},created(){this.$store.registerModule("localizer",y),this.$store.watch(a=>a.localizer.translations,()=>{this.initiallyLoaded&&this.$store.dispatch(c),this.initiallyLoaded=!0},{deep:!0})},mounted(){this.loadLanguages(),this.loadTranslations()},methods:{async loadLanguages(){const{data:a}=await this.$api.get("/translations");this.$store.dispatch(h,a)},async loadTranslations(){const a=await this.$api.get("/localizer");this.$store.dispatch(u,a),this.$store.dispatch(d)},async save(){await this.$api.post("/localizer",this.translations),this.$store.dispatch(u,this.translations),this.$store.dispatch(d),this.$store.dispatch(c),this.$refs.reloadDialog.open()},revert(){this.$store.dispatch(_),this.$store.dispatch(d),this.$store.dispatch(c)},reload(){window.location.reload()}}};var J=function(){var t=this,e=t._self._c;return e("k-inside",[e("k-view",{staticClass:"k-localizer"},[e("k-header",{staticClass:"k-localizer-header"},[e("div",{staticClass:"headline-wrap"},[t._v("Localizer "),e("span",{staticClass:"beta-badge"},[t._v("BETA")])]),e("k-text",{attrs:{slot:"right"},slot:"right"},[e("span",{staticClass:"k-localizer-header-desc"},[t._v("Override Panel and Plugin translations.")])]),e("LocalizerLanguageDialog",{attrs:{slot:"left"},slot:"left"})],1),e("LocalizerTranslationList"),t.isDirty?e("k-button-group",[e("nav",{staticClass:"k-form-buttons",attrs:{"data-theme":"notice"}},[e("k-view",[e("k-button",{staticClass:"k-form-button",attrs:{text:t.$t("revert"),icon:"undo",disabled:t.isLoading},on:{click:t.revert}}),e("k-button",{staticClass:"k-form-button",attrs:{text:t.$t("save"),icon:"check",disabled:t.isLoading},on:{click:t.save}})],1),e("k-dialog",{ref:"revert",attrs:{"submit-button":t.$t("revert"),icon:"undo",theme:"negative"},on:{submit:t.revert}},[e("k-text",{domProps:{innerHTML:t._s(t.$t("revert.confirm"))}})],1)],1)]):t._e(),e("k-dialog",{ref:"reloadDialog",attrs:{"submit-button":"Reload",theme:"positive",icon:"undo"},on:{submit:t.reload}},[e("header",[e("k-headline",[t._v("Reload Panel?")]),e("k-text",{attrs:{size:"small",theme:"help"}},[t._v(" In order to apply your changes, you need to reload the panel manually. ")])],1)])],1)],1)},K=[],X=l(H,J,K,!1,null,"63cd4368",null,null);const j=X.exports;window.panel.plugin("gearsdigital/localizer-for-kirby",{components:{"k-panel-localizer-area":j}})})();
